<div data-ng-controller="HomeController" data-ng-init="init()">

	<div class="row" style="margin-top:5px;margin-bottom:10px;margin-left:0px;margin-right:0px;">
		<div class="col-md-12">
			<h2 style="margin-top:0px;margin-bottom:20px;margin-left:0px;margin-right:0px;text-align: center;">
				Patient List
			</h2>
		</div>
	</div>

  	<table class="table">
		<thead>
      		<tr>
        		<th>
          			<a href="#/" ng-click="orderByField='firstName'; reverseSort = !reverseSort">
         			 Patient Name <span ng-show="orderByField == 'firstName'"><span ng-show="!reverseSort"></span><span ng-show="reverseSort"></span></span>
         			 </a>
        		</th>
        		<th>
          			<a href="#/" ng-click="orderByField='days'; reverseSort = !reverseSort">
           			 Days Since Discharge <span ng-show="orderByField == 'days'"><span ng-show="!reverseSort"></span><span ng-show="reverseSort"></span></span>
          			</a>
       			 </th>
       			 <th>
          			<a href="#/">
         			 Questionnaire
         			 </a>
        		</th>
       		</tr>
       	</thead>
      	<tbody>
  			<tr ng-repeat-start="patient in patients | orderBy:orderByField:reverseSort">
   				 <td>{{patient.firstName + ' ' + patient.lastName}}</td>
   				 <td><span>{{patient.days}}</span></td>
       			 <td>
       			 	<div ng-repeat="questionnaire in patient.questionnaires">
		       			<span ng-if="questionnaire.days < patient.days" >
		       				<span ng-if="questionnaire.answered" >{{questionnaire.title}}</span>
							<a href ng-if="!questionnaire.answered" ng-click="viewQuestionnaire(patient)">
								<span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
								{{questionnaire.title}}
							</a>
		       			</span>
		       			<span ng-if="questionnaire.answered" >(<a href="#/">{{questionnaire.id}}</a>)</span>
					</div>						
       			 </td>
       		</tr>
       		<tr ng-repeat-end ng-show="activeRow==patient.firstName">
           		<td ng-show="showing" colspan="5">
           			<pre id="json">
           				<json-formatter json="patient.qresponse" open="1"></json-formatter>
           			</pre>
           			<a href ng-click="downloadQuestionnaireResponseCSV(patient)" style="margin-right:60px;">
						<span class="glyphicon glyphicon-download-alt" aria-hidden="true"> CSV</span>
					</a>
					<a href ng-click="downloadQuestionnaireResponseJSON(patient)" id="downloadAnchorElem">
						<span class="glyphicon glyphicon-download-alt" aria-hidden="true"> JSON</span>
					</a>
           		</td>
       		</tr>        			 
   		</tbody>		 
	</table>
</div>